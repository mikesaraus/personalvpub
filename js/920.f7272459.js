"use strict";(globalThis["webpackChunkpersonal"]=globalThis["webpackChunkpersonal"]||[]).push([[920],{7920:(e,t,s)=>{s.r(t),s.d(t,{default:()=>H});var a=s(3673),i=s(2323),o=s(8880);const r={key:0,class:"text-center"},n=(0,a._)("br",null,null,-1),l={key:0,class:"text-caption text-italic text-weight-light"},d={key:1},p={key:1},c={class:"text-weight-bold text-primary"},m={key:0,class:"text-caption text-weight-thin"};function h(e,t,s,h,g,u){const f=(0,a.up)("q-btn"),w=(0,a.up)("q-intersection"),y=(0,a.up)("q-circular-progress"),x=(0,a.up)("q-tooltip"),b=(0,a.up)("q-icon"),M=(0,a.up)("q-item-section"),C=(0,a.up)("q-item"),k=(0,a.up)("q-separator"),_=(0,a.up)("q-list"),v=(0,a.up)("q-menu"),U=(0,a.up)("q-chat-message"),D=(0,a.up)("q-slider"),q=(0,a.up)("q-input"),W=(0,a.up)("q-form"),S=(0,a.up)("q-toolbar"),I=(0,a.up)("q-footer"),$=(0,a.up)("q-page"),E=(0,a.Q2)("ripple"),z=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)($,{ref:"pageChat",class:"page-chat flex",style:{"max-width":"100%"}},{default:(0,a.w5)((()=>[(0,a._)("div",{class:(0,i.C_)(["col column justify-end q-pa-lg",{invisible:!e.showChatContents}])},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.groupedMessages,((t,s)=>((0,a.wg)(),(0,a.j4)(U,{key:"message_"+s,sent:"me"==t[0].data.from.toLowerCase(),"bg-color":"me"==t[0].data.from.toLowerCase()?"grey-3":"secondary"},{name:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)("me"==t[0].data.from.toLowerCase()?e.userDetails.name:e.otherUserDetails.name),1)])),default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t,((t,c)=>((0,a.wg)(),(0,a.iD)("div",{class:"text-body2",key:"message_"+s+"_"+c},[e.decryptedMsg[t.id]?((0,a.wg)(),(0,a.iD)("div",d,[(0,a._)("span",{class:(0,i.C_)("me"==t.data.from.toLowerCase()?"text-grey-10":"text-grey-9")},[(0,a.Wm)(w,{once:"",transition:"scale",innerHTML:e.addLinkHtml(e.decryptedMsg[t.id].plain)},null,8,["innerHTML"])],2),(0,a._)("div",{class:(0,i.C_)(["text-caption","me"==t.data.from.toLowerCase()?"text-grey-6":"text-white"])},[(0,a._)("span",null,["me"!=t.data.from.toLowerCase()&&t.data.expiration?((0,a.wg)(),(0,a.j4)(y,{key:0,reverse:"",min:0,max:t.data.expiration/1e3,value:e.clockCountDown[t.id],thickness:1,size:"16px",color:"primary","track-color":"grey-4"},null,8,["max","value"])):(0,a.kq)("",!0),"me"!=t.data.from.toLowerCase()&&t.data.expiration?((0,a.wg)(),(0,a.iD)("span",p,"Â ")):(0,a.kq)("",!0),(0,a.Wm)(x,{delay:100,offset:[10,15],self:"top middle",anchor:"bottom middle"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Deletion Countdown ")])),_:1})]),((0,a.wg)(),(0,a.iD)("span",{key:e.minuteTimer},(0,i.zw)(e.relativeDate(t.data.timestamp)),1))],2)])):((0,a.wg)(),(0,a.iD)("div",r,[(0,a.Wm)(o.W3,{appear:"","enter-active-class":"animated fadeIn slow"},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)("div",{class:"text-center",key:t.id},[(0,a.Wm)(f,{onClick:s=>e.decryptMsg(t),round:"",ripple:"",size:"md",color:"primary",icon:t.data.expiration?"auto_delete":"enhanced_encryption","text-color":"me"==t.data.from.toLowerCase()?"grey-3":"white"},null,8,["onClick","icon","text-color"]),n,t.data.expiration?((0,a.wg)(),(0,a.iD)("span",l,(0,i.zw)(t.data.expiration/1e3)+" sec ",1)):(0,a.kq)("",!0)]))])),_:2},1024)])),(0,a.Wm)(v,{"touch-position":"","context-menu":""},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.wy)(((0,a.wg)(),(0,a.j4)(C,{clickable:"",onClick:s=>e.removeMessage({msgid:t.id,usrid:e.otherUserId,deleteForEveryone:!1})},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{avatar:"",style:{"min-width":"35px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{name:"delete"})])),_:1}),(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Yourself")])),_:1})])),_:2},1032,["onClick"])),[[E],[z]]),"me"==t.data.from.toLowerCase()?((0,a.wg)(),(0,a.j4)(k,{key:0})):(0,a.kq)("",!0),"me"==t.data.from.toLowerCase()?(0,a.wy)(((0,a.wg)(),(0,a.j4)(C,{key:1,clickable:"",onClick:s=>e.removeMessage({msgid:t.id,usrid:e.otherUserId,deleteForEveryone:!0})},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{avatar:"",style:{"min-width":"35px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{name:"delete_sweep"})])),_:1}),(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Everyone")])),_:1})])),_:2},1032,["onClick"])),[[E],[z]]):(0,a.kq)("",!0)])),_:2},1024)])),_:2},1024),e.decryptedMsg[t.id]?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(x,{key:2,delay:100,offset:[10,15],self:"top middle",anchor:"bottom middle"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(e.relativeDate(t.data.timestamp)),1)])),_:2},1024))])))),128))])),_:2},1032,["sent","bg-color"])))),128))],2),(0,a.Wm)(I,{elevated:"",class:"transparent"},{default:(0,a.w5)((()=>[(0,a.Wm)(S,{class:"full-width q-pa-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{class:"full-width"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.Wm)(o.uT,{appear:"","enter-active-class":"animated bounceInLeft slow","leave-active-class":"animated bounceOutRight slow"},{default:(0,a.w5)((()=>[e.expirationEnabled?((0,a.wg)(),(0,a.j4)(C,{key:0,class:"q-pa-sm",style:{"background-color":"rgba(255, 255, 255, 0.5)"}},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{avatar:""},{default:(0,a.w5)((()=>[(0,a._)("div",c,[(0,a.Wm)(b,{color:"primary",name:"auto_delete",size:"sm"}),(0,a.Uk)(" "+(0,i.zw)(e.newMessage.expiration)+" seconds ",1),(0,a.Wm)(x,{delay:100,offset:[10,20],anchor:"top middle",self:"bottom middle"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Auto Delete Message ")])),_:1})])])),_:1}),(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[(0,a.Wm)(D,{modelValue:e.newMessage.expiration,"onUpdate:modelValue":t[0]||(t[0]=t=>e.newMessage.expiration=t),onChange:t[1]||(t[1]=t=>{e.newMessage.expiration=t,e.$q.platform.is.mobile||e.$refs.newMessage.focus()}),color:"primary",min:e.expiration.min,max:e.expiration.max},null,8,["modelValue","min","max"])])),_:1}),(0,a.Wm)(M,{side:""},{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a.Wm)(f,{flat:"",round:"",ripple:"",color:"primary",icon:"remove_circle_outline",onClick:t[2]||(t[2]=()=>{e.newMessage.expiration>e.expiration.min&&e.newMessage.expiration--,e.$q.platform.is.mobile||e.$refs.newMessage.focus()})},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{delay:100,offset:[10,20],anchor:"top middle",self:"bottom middle"},{default:(0,a.w5)((()=>[(0,a.Uk)(" -1 ")])),_:1})])),_:1}),(0,a.Wm)(f,{flat:"",round:"",ripple:"",color:"primary",icon:"add_circle_outline",onClick:t[3]||(t[3]=()=>{e.newMessage.expiration<e.expiration.max&&e.newMessage.expiration++,e.$q.platform.is.mobile||e.$refs.newMessage.focus()})},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{delay:100,offset:[10,20],anchor:"top middle",self:"bottom middle"},{default:(0,a.w5)((()=>[(0,a.Uk)(" +1 ")])),_:1})])),_:1}),(0,a.Wm)(f,{flat:"",round:"",ripple:"",color:"primary",icon:"highlight_off",onClick:t[4]||(t[4]=()=>{e.expirationEnabled=!e.expirationEnabled,e.$q.platform.is.mobile||e.$refs.newMessage.focus()})},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{delay:100,offset:[10,20],anchor:"top middle",self:"bottom middle"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Non-Expiry ")])),_:1})])),_:1})])])),_:1})])),_:1})):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(C,{class:"q-pa-sm bg-primary"},{default:(0,a.w5)((()=>[(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[(0,a.Wm)(q,{dense:"",rounded:"",autogrow:"",outlined:"",tabindex:"1",maxlength:"1024","bg-color":"white",ref:"newMessage",modelValue:e.newMessage.text,"onUpdate:modelValue":t[6]||(t[6]=t=>e.newMessage.text=t),onKeyup:e.updateFirstChange,onKeydown:(0,o.D2)((0,o.iM)(e.sendMessage,["exact","prevent"]),["enter"]),autofocus:!e.$q.platform.is.mobile&&(!!e.isValidChat||!e.isSelfChat),disable:!e.isValidChat&&!e.isSelfChat,label:e.newMessage.text?void 0:e.isValidChat?"Message":e.isSelfChat?"Secret Message":e.otherUserId||e.isValidChat?"Chat Unavailable":"Select Someone"},{before:(0,a.w5)((()=>[(0,a.Wm)(b,{size:"sm",color:"grey-3",name:e.expirationEnabled?"enhanced_encryption":"lock"},null,8,["name"])])),append:(0,a.w5)((()=>[(0,a._)("div",null,[e.expirationEnabled?((0,a.wg)(),(0,a.iD)("sub",m,(0,i.zw)(e.newMessage.expiration)+"s ",1)):(0,a.kq)("",!0),(0,a.Wm)(f,{round:"",dense:"",flat:"",size:"sm",color:"primary",icon:"auto_delete",ref:"expirationBtn",disable:!e.isValidChat&&!e.isSelfChat,onClick:t[5]||(t[5]=()=>{e.expirationEnabled=!e.expirationEnabled,e.$q.platform.is.mobile||e.$refs.newMessage.focus()})},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{anchor:"top middle",self:"bottom middle",offset:[10,20],delay:100},{default:(0,a.w5)((()=>[(0,a.Uk)(" Auto Delete Message ")])),_:1})])),_:1},8,["disable"])])])),after:(0,a.w5)((()=>[(0,a.Wm)(f,{flat:"",round:"",dense:"",icon:"send",tabindex:"2",type:"submit",color:"white",onClick:e.sendMessage,disable:!e.isValidChat&&!e.isSelfChat},null,8,["onClick","disable"])])),_:1},8,["modelValue","onKeyup","onKeydown","autofocus","disable","label"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},512)}s(3610),s(5663),s(5363);var g=s(8825),u=s(741),f=s(3552),w=s(6386),y=s(2490),x=s(3493);const b=(0,a.aZ)({name:"Chat App",mixins:[f.k0,f.y7,f.E1],data(){return{$q:(0,g.Z)(),newMessage:{from:"me",text:null,timestamp:Date.now(),type:y.myvar.messages.type.encrypted,expiration:0},expiration:{min:3,max:90},expirationEnabled:!1,showChatContents:!1,myMessages:[],decryptedMsg:{},firstChat:!0,clockCountDown:{},addLinkHtml:w.it}},beforeMount(){this.otherUserId&&this.userDetails.passphrase&&this.initializeUserMessages()},mounted(){this.otherUserId&&this.userDetails.passphrase&&!this.groupedMessages.length&&this.initializeUserMessages(),this.newMessage.expiration=this.expiration.min},computed:{...(0,u.Se)("firebase_chat",["groupedMessages"]),...(0,u.Se)("firebase_notification",["notifMessages"]),...(0,u.rn)("firebase_auth",["userDetails"]),...(0,u.rn)("firebase_chat",["messages"]),isValidChat(){let e=!1;return this.otherUserId&&this.userDetails.passphrase&&this.otherUserDetails&&Object.keys(this.otherUserDetails).length&&(e=!0),e}},watch:{messages:{async handler(e){const t=Object.keys(e);t.length&&(t.forEach((async t=>{this.decryptedMsg[t]&&this.decryptedMsg[t].encrypted!=e[t].text&&this.decryptMsg({id:t,data:{from:e[t].from.toLowerCase(),text:e[t].text},watch:!0})})),t.length!==Object.keys(this.decryptedMsg).length&&Object.keys(this.decryptedMsg).forEach((async e=>{t.includes(e)||delete this.decryptedMsg[e]})),this.$myvar.messages.lastEvent&&"added"===this.$myvar.messages.lastEvent&&this.chatScrollToBottom())},deep:!0},otherUserId:{async handler(e){e?this.initializeUserMessages():this.firebaseStopGettingMessages()},deep:!0},expirationEnabled:{handler(e){e||(this.firstChat=!1)},deep:!0}},methods:{...(0,u.nv)("firebase_notification",["deleteNotification","deleteNotificationData"]),...(0,u.nv)("firebase_chat",["firebaseGetMessages","firebaseSendMessage","firebaseDeleteMessage","firebaseStopGettingMessages"]),async initializeUserMessages(){try{this.userDetails.passphrase&&this.otherUserId&&(await this.firebaseStopGettingMessages(),this.showChatContents=!1,this.firebaseGetMessages({otherUserId:this.otherUserId}),this.firstChat=!0,this.clearMessage())}catch(e){console.error("Chat Initialization Error: ",e)}},updateFirstChange(){this.firstChat&&this.newMessage.text&&(this.expirationEnabled||this.$refs.expirationBtn.click())},checkIfOnDeletion(e){const t=this.$myvar.messages.todelete;let s=Object.keys(t).filter((t=>t===e));return!!s.length},async decryptMsg(e){let t;return await this.$openpgp_methods.decrypt_string({privateKeyArmored:w.US.decode(this.userDetails.pgp.privateKey),publicKeyArmored:w.US.decode("me"==e.data.from.toLowerCase()?this.userDetails.pgp.publicKey:this.otherUserDetails.pgp.publicKey),passphrase:w.US.decode(this.userDetails.passphrase),encryptedText:w.US.decode(e.data.text)}).then((s=>{if(s.success){if(this.decryptedMsg[e.id]={plain:s.response,encrypted:e.data.text},!e.watch&&e.data.expiration&&"me"!=e.data.from.toLowerCase()){const t={msg:this.decryptedMsg[e.id].plain,msgid:e.id,usrid:this.otherUserId,deleteForEveryone:!0};this.notifMessages[this.otherUserId]&&this.notifMessages[this.otherUserId].length&&this.deleteNotificationData({notifUser:this.userDetails.userId,notifId:this.otherUserId,notifType:x.s.notifications.messages,deleteKey:1==this.notifMessages[this.otherUserId].length,notifDetails:{id:e.id,timestamp:e.data.timestamp,type:e.data.type}}),this.clockCountDown[e.id]=1;let s=setInterval((()=>{this.clockCountDown[e.id]+=1,this.clockCountDown[e.id]>=e.data.expiration/1e3&&clearInterval(s)}),1e3);setTimeout((()=>{this.$myvar.messages.todelete.push(t),this.clockCountDown[e.id]&&delete this.clockCountDown[e.id]}),e.data.expiration)}t=s.response}else(0,w.qz)("Failed to decrypt message","warning")})).catch((e=>{(0,w.qz)("Error decrypting message","negative")})),(0,w.it)(t)},async sendMessage(){if(this.newMessage.text){const e=this.newMessage.text.replace(/^\s+|\s+$/g,"");await this.$openpgp_methods.encrypt_string({publicKeysArmored:[w.US.decode(this.otherUserDetails.pgp.publicKey),w.US.decode(this.userDetails.pgp.publicKey)],privateKeyArmored:w.US.decode(this.userDetails.pgp.privateKey),passphrase:w.US.decode(this.userDetails.passphrase),plainText:e}).then((e=>{if(e.success){let t={from:"me",text:w.US.encode(e.response),timestamp:Date.now(),type:this.expirationEnabled&&this.newMessage.expiration?y.myvar.messages.type.encrypted_autodelete:y.myvar.messages.type.encrypted,expiration:this.expirationEnabled&&this.newMessage.expiration?1e3*this.newMessage.expiration:0};this.firebaseSendMessage({message:t,otherUserId:this.otherUserId}),this.chatScrollToBottom()}else(0,w.qz)("Failed to encrypt message","warning")})).catch((()=>{(0,w.qz)("Error encrypting message","negative")}))}this.clearMessage()},async removeMessage(e){await this.firebaseDeleteMessage({messageId:e.msgid,otherUserId:e.usrid,deleteForEveryone:e.deleteForEveryone}).then((e=>{e.success?(0,w.qz)("Message has been deleted","positive",null,this.$q.screen.lt.sm?"top":"bottom-left"):(0,w.qz)("Failed to delete message","warning",null,this.$q.screen.lt.sm?"top":"bottom-left")})).catch((()=>{(0,w.qz)("Error deleting message","negative",null,this.$q.screen.lt.sm?"top":"bottom-left")}))},clearMessage(){this.newMessage={from:"me",text:null,timestamp:Date.now(),type:y.myvar.messages.type.encrypted,expiration:this.newMessage.expiration},!this.$q.platform.is.mobile&&this.$refs.newMessage&&this.$refs.newMessage.focus()},chatScrollToBottom(){setTimeout((()=>{this.$refs.chatScrollArea?this.$refs.chatScrollArea.setScrollPosition("vertical",2*this.$refs.chatScrollArea.$el.scrollHeight):window.scrollTo(0,2*this.$refs.pageChat.$el.scrollHeight),this.showChatContents||(this.showChatContents=!0)}),20)}},beforeUnmount(){this.firebaseStopGettingMessages()}});var M=s(4260),C=s(4379),k=s(629),_=s(8240),v=s(8218),U=s(6122),D=s(8870),q=s(811),W=s(7011),S=s(3414),I=s(2035),$=s(4554),E=s(5869),z=s(1762),Z=s(9570),L=s(5269),Q=s(2064),K=s(4842),T=s(6489),j=s(677),V=s(7518),F=s.n(V);const A=(0,M.Z)(b,[["render",h]]),H=A;F()(b,"components",{QPage:C.Z,QChatMessage:k.Z,QBtn:_.Z,QIntersection:v.Z,QCircularProgress:U.Z,QTooltip:D.Z,QMenu:q.Z,QList:W.Z,QItem:S.Z,QItemSection:I.Z,QIcon:$.Z,QSeparator:E.Z,QFooter:z.Z,QToolbar:Z.Z,QForm:L.Z,QSlider:Q.Z,QInput:K.Z}),F()(b,"directives",{Ripple:T.Z,ClosePopup:j.Z})}}]);